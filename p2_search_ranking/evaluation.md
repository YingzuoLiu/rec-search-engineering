# Evaluation：Offline vs Online

本文档说明本搜索 / 排序系统在项目中的评估方式，并重点解释
**离线评估（Offline Evaluation）** 与 **在线评估（Online Evaluation）**
在推荐 / 搜索系统中的区别、作用和局限。

---

## 1. 为什么需要评估（Evaluation）

在搜索与推荐系统中，模型好坏不能仅通过训练 loss 判断。
真正重要的是系统是否能够：

- 把更相关的结果排在前面
- 提升用户点击和使用体验
- 在满足效果的同时控制延迟和稳定性

因此，工业界通常将评估分为 **离线评估** 和 **在线评估** 两个阶段，
分别服务于不同目标。

---

## 2. 离线评估（Offline Evaluation）

### 2.1 离线评估的目的

离线评估主要用于：

- 对比不同模型 / 特征 / 排序策略
- 在不影响真实用户的情况下快速迭代
- 在上线前过滤掉明显无效或退化的方案

它回答的问题是：

> **“基于历史数据，这个模型是否比 baseline 排得更好？”**

---

### 2.2 数据构建方式（本项目语境）

由于这是一个个人项目，不存在真实线上流量：

- 使用数据集中已有的用户–物品交互记录
- 将点击 / 交互行为视为相关性信号
- 构造训练集与验证集进行评估

该过程模拟了工业中常见的 **基于日志的离线评估流程**。

---

### 2.3 使用的离线指标

#### NDCG@K（主要指标）

- 衡量排序结果的整体质量
- 对排在前面的相关结果给予更高权重
- 是搜索与推荐系统中最常用的排序指标之一

用于回答：

> **“相关结果是否被排在了更靠前的位置？”**

---

#### Recall@K（辅助指标）

- 衡量相关结果是否被召回到候选集合中
- 常用于评估召回阶段或整体覆盖能力

用于回答：

> **“系统是否找回了足够多有价值的候选结果？”**

---

### 2.4 离线 Baseline 设计

为了保证评估结果具有可解释性和参考价值，使用以下 baseline：

- **Random 排序**：基础 sanity check
- **Popularity-based 排序**：工业中常见、且较强的基线方法

只有当模型在不同 K 值下，**稳定优于这些 baseline** 时，
才认为模型具备改进价值。

---

### 2.5 离线评估的局限性

离线评估本身存在已知问题：

- 数据存在曝光偏差（exposure bias）
- 用户行为受到历史排序策略影响
- 离线指标提升不一定等价于线上指标提升

因此，离线评估只能作为 **必要但不充分** 的条件，
不能直接等价为真实用户效果。

---

## 3. 在线评估（Online Evaluation，概念说明）

### 3.1 在线评估的目的

在线评估用于衡量系统在真实用户场景下的实际效果，
关注的是：

> **“这个模型是否真的改变了用户行为？”**

---

### 3.2 常见在线指标

工业界常用的在线指标包括：

- CTR（点击率）
- 转化率
- 停留时长
- 会话成功率等

这些指标直接反映用户体验和业务结果。

---

### 3.3 A/B Test（在线评估标准方式）

真实系统中，排序模型通常通过 A/B Test 进行验证：

- 将用户随机分流为对照组和实验组
- 两组使用不同的排序策略
- 在相同流量条件下对比关键指标

A/B 测试被认为是验证排序改进的 **黄金标准**。

---

### 3.4 本项目未实现在线评估的原因

由于本项目不包含真实用户和线上流量：

- 无法获取真实在线行为指标
- 无法进行 A/B 测试

但系统在设计上遵循真实线上系统结构，
若接入真实服务层与流量，可自然扩展到在线评估流程。

---

## 4. Offline vs Online 对比总结

| 维度 | 离线评估 | 在线评估 |
|---|---|---|
| 数据来源 | 历史日志 | 实时用户行为 |
| 迭代速度 | 快 | 慢 |
| 风险 | 无用户风险 | 直接影响用户 |
| 偏差 | 曝光 / 日志偏差 | 较少 |
| 目标 | 模型筛选 | 验证真实收益 |

---

## 5. 实际工业中的评估流程

在真实系统中，评估通常遵循以下步骤：

1. 离线评估筛选模型
2. 小流量 A/B 测试
3. 逐步放量 + 监控 + 回滚机制

本项目聚焦于 **第一步（离线评估）**，
并明确说明其局限性，而不假设不存在的线上结果。

---

## 6. 总结

- 离线评估是搜索 / 推荐系统中必不可少的一步
- NDCG@K 与 Recall@K 是合理且常用的离线排序指标
- 在线评估用于验证真实用户价值
- 离线提升不保证线上提升
- 本项目采用工业标准的离线评估方法，并清晰界定其适用范围
